# 函数

程序员在 Python 中使用的第一个组织工具是**函数**（function）。

## [第 19 项：当函数返回多个值时，切勿拆分三个以上的变量](../code/ch03/item19.py)

unpacking 语法的作用之一是它允许 Python 函数返回多个值。

假设正在尝试确定鳄鱼种群的各种统计数据。给定一个长度列表，需要计算总体中的最小和最大长度。

```python
>>> def get_stats(numbers):
...     minimum = min(numbers)
...     maximum = max(numbers)
...     return minimum, maximum
...
>>>
>>> lengths = [63, 73, 72, 60, 67, 66, 71, 61, 72, 70]
>>> 
>>> minimum, maximum = get_stats(lengths)  # Two return values
>>> print(f"Min: {minimum}, Max: {maximum}")
Min: 60, Max: 73
>>>
```

其工作方式是将多个值一起返回到一个包含两项的元组中。然后，调用代码通过分配两个变量来拆解返回的元组。

在返回多个值的时候，可以用带星号的表达式接收那些没有被普通变量捕获的值。比如需要计算每条鳄鱼占平均值的比例，需要知道最大和最小的比例。

```python
>>> lengths = [63, 73, 72, 60, 67, 66, 71, 61, 72, 70]
>>> def get_avg_ratio(numbers):
...     average = sum(numbers) / len(numbers)
...     scaled = [x / average for x in numbers]
...     scaled.sort(reverse=True)
...     return scaled
... 
>>>
>>> longest, *middle, shortest = get_avg_ratio(lengths)
>>> print(f"Longest:  {longest:>4.0%}")
Longest:  108%
>>> print(f"Shortest: {shortest:>4.0%}")
Shortest:  89%
>>>
```

假设现在需要返回描述性统计的那些值，

```python
>>> def get_stats(numbers):
...     minimum = min(numbers)
...     maximum = max(numbers)
...     count = len(numbers)
...     average = sum(numbers) / count
...     sorted_numbers = sorted(numbers)
...     middle = count // 2
...     if count % 2:
...         median = sorted_numbers[middle]
...     else:
...         lower = sorted_numbers[middle - 1]
...         upper = sorted_numbers[middle]
...         median = (lower + upper) / 2
...     return minimum, maximum, average, median, count
...
>>> minimum, maximum, average, median, count = get_stats(lengths)
>>> print(f"Min: {minimum}, Max: {maximum}")
Min: 60, Max: 73
>>> print(f"Average: {average}, Median: {median}, Count: {count}")
Average: 67.5, Median: 68.5, Count: 10
>>>
```

这样写的代码有两个问题：

1. 很容易搞错顺序，而导致使用错误的数据，比如说本来中位数变成了平均值
2. 如果接收的变量很多，根据 PEP8 风格指南，那么很可能会导致代码换行，这会是的代码阅读起来不方便

```python
# Correct:
minimum, maximum, average, median, count = get_stats(lengths)

# Oops! Median and average swapped:
minimum, maximum, median, average, count = get_stats(lengths)
```

```python
minimum, maximum, average, median, count = get_stats(
    lengths)

minimum, maximum, average, median, count = \
    get_stats(lengths)
(minimum, maximum, average, 
 median, count) = get_stats(lengths)
(minimum, maximum, average, median, count
 ) = get_stats(lengths)
```

为了避免这些问题，在从函数中解包多个返回值时，切勿使用超过三个变量。一个三元素的元组最多拆解三个变量，或两个变量与一个万能变量（带星号的变量）。如果需要拆包比这更多的返回值，最好定义一个轻量级类或 `namedtuple` 并让函数返回一个实例那个。

> 小结
>
> 1. 可以让函数返回多个值，方法是将它们放入元组中并让调用者利用 Python 的 unpacking 语法。
> 2. 函数的多个返回值也可以通过带星号表达式来解包，这样没有被捕获的变量全部都在星号变量中。
> 3. 解包为四个或更多变量很容易出错，应该避免；可以返回一个类或 `namedtuple` 实例来替代。
