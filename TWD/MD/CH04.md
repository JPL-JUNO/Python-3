# 模板和媒体文件

## 使用模板

为什么使用模板？网站中的不同页面通常使用相同的布局，提供通用的页头（header）和页脚（footer），为用户呈现导航，体现一种一致性。Django 模板能让开发者轻易实现这样的设计要求，而且还能把应用逻辑（视图代码）与表现（应用的外观）区分开。
> Django 的模板可以理解为构建完整的 HTML 页面所需的骨架。模板中有静态内容（不变的部分），也有特殊的句法（动态内容，即模板标签）。Django 视图会把动态内容替换成真正的数据，生成最终的 HTML 响应。

配置模板目录若想在 Django 应用中使用模板，要创建两个目录，用于存放模板文件。在 Django 项目配置目录（workspace/tango_with_django_project/）中创建一个名为 templates 的目录。注意，这个目录要与项目的 manage.py 脚本放在同一级。在这个新目录中再创建一个目录，名为 rango。

接下来要告诉 Django 你把模板放在什么位置。打开项目的 settings.py 文件，找到 TEMPLATES。

### 动态路径

settings.py 文件的顶部有个名为 `BASE_DIR` 的变量，它的值是 settings.py 文件所在目录的路径。这里用到了 Python 的特殊属性 `__file__`，它的值是所在文件的绝对路径。调用 os.path.dirname() 的作用是获取 settings.py 文件所在目录的绝对路径，再调用一次 os.path.dirname() 又去掉一层，因此 `BASE_DIR` 最终的值是 workspace/tango_with_django_project/。

### 添加一个模板
>
> **模板上下文是什么？**
> Django 的模板系统加载模板文件时会创建一个模板上下文。简单而言，模板上下文是一个Python 字典，把模板变量名映射到值上。
>
## 伺服静态文件

我们可以在 HTML 模板中引用其他文件，例如层叠样式表（Cascading Style Sheet，CSS）、JavaScript 和图像。这些是*静态文件*（static file），因为它们不是由 Web 服务器动态生成的，而是原封不动发给 Web 浏览器。

### 配置静态文件目录

首先要指定一个目录，用于存放静态文件。在项目配置目录中新建一个目录，名为 `static`，然后在 `static` 目录中再新建一个目录，名为 images。确保 `static` 目录与前面创建的 `templates` 目录位于同一级。

我们要告诉 Django 这个 static 目录的路径。为此，还要编辑项目的settings.py 模块。在这个文件中，我们要定义一个变量，指向 static 目录，并在一个数据结构中告诉 Django 这个目录的路径。

简单来说，`STATIC_DIR` 和 `STATICFILES_DIRS` `两个变量设定静态文件在电脑中的位置；STATIC_URL` 变量则指定启动 Django 开发服务器后通过什么 URL 访问静态文件。例如，把 `STATIC_URL` 设为 /static/ 后，我们可以通过 `http://127.0.0.1:8000/static/` 访问里面的静态内容。前两个变量相当于服务器端的位置，而第三个变量是客户端访问静态内容的位置。

## 伺服媒体文件

应用中的静态文件可以理解为不变的文件。不过，有时还要使用可变的媒体文件（media file）。这类文件可由用户或管理员上传，因此可能会变化。比如说，用户的头像就是媒体文件，电商网站中的商品图片也是媒体文件。

## 基本流程

如何创建模板，并在 Django 视图中使用模板。这其中涉及好几步：

1. 首先，创建要使用的模板，保存到 templates 目录中（在项目的 settings.py 模块中设定）。模板中可以使用 Django 模板变量（例如 {{ variable_name }}）或模板标签。模板变量的值在相应的视图中设定。
2. 在应用的 views.py 文件中找到所需的视图，或者新建一个。
3. 把视图相关的逻辑写在视图函数中。例如，从数据库中检索数据，存到列表中。
4. 在视图中构建一个字典，通过模板上下文传给模板引擎。
5. 使用 render() 辅助函数生成响应。这个函数的参数是请求对象、模板文件名和上下文字典。
6. 如果还没把视图映射到 URL 上，修改项目的 urls.py 文件和应用的 urls.py 文件。在网页中引入静态文件的步骤也很重要，应该熟练掌握。具体方法参见下述步骤。

在网页中引入静态文件的步骤也很重要。具体方法参见下述步骤。

1. 把想用的静态文件放到项目的 static 目录中。这个目录在项目的 settings.py 模块中的 `STATICFILES_DIRS` 列表中设定。
2. 在模板中引用静态文件。例如，图像通过 `<img />` 标签插入 HTML 页面。
3. 记得在模板中加上 `{% load staticfiles %}`，然后使用 `{% static "filename" %}` 标签引用静态文件。把 filename 替换成图像或其他资源的路径。只要想引用静态文件，使用 static 模板标签。

伺服媒体文件的步骤与伺服静态文件差不多。

1. 把媒体文件放到项目的 media 目录中。这个目录由项目的 settings.py 模块中的 `MEDIA_ROOT` 变量设定。
2. 在模板中使用 `{{ MEDIA_URL }}` 上下文变量引用媒体文件。例如，引用上传的图像
`cat.jpg：<img src="{{ MEDIA_URL}}cat.jpg" />`。
>
> 从名称可以看出，静态文件是不变的，是网站的核心构成组件。而媒体文件是用户提供的，时常变化。
> 样式表是静态文件，定义网页的外观。而用户的头像是媒体文件，用户在注册账户时上传。
